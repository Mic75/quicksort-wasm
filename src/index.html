<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title></title>
</head>
<body>
<script type="module">

  import generateData from "./input-generator.js";
  import quicksort from "./quicksort.js";
  import WasmModule from "./quicksort-wasm.js";

  console.log("Generating input data");
  const millionInt = generateData(0, 1000, 1000000);
  const tenMillionInt = generateData(0, 1000, 10000000);
  const hundredMillionInt = generateData(0, 1000, 100000000);
  let time;
  console.log("Input Generated");

  console.log("Starting benchmark\n\n");

  // builtin Ecmascript sort
  console.log("Builtin Ecmascript sort");
  time = Date.now();
  millionInt.sort();
  console.log(` - 10\u2076 entries sorted in ${Date.now() - time}ms`);

  time = Date.now();
  tenMillionInt.sort();
  console.log(` - 10\u2077 entries sorted in ${Date.now() - time}ms`);

  time = Date.now();
  hundredMillionInt.sort();
  console.log(` - 10\u2078 entries sorted in ${Date.now() - time}ms`);

  console.log("\n");

  // Pure JS Lomuto quicksort
  console.log("Monothreaded Lomuto Quicksort, pure JS");
  let millionIntClone = millionInt.slice();
  time = Date.now();
  quicksort(millionIntClone, 0, millionInt.length - 1);
  console.log(` - 10\u2076 entries sorted in ${Date.now() - time}ms`);

  // !MAXIMUM calls stack exceeded
  // time = Date.now();
  // quicksort(hundredMillionInt, 0, hundredMillionInt.length - 1);
  // console.log(` - 10\u2077 entries sorted in ${Date.now() - time}ms`);

  console.log("\n");

  // WebAssembly Lomuto quicksort
  WasmModule().then(wasm => {
    console.log("Monothreaded Lomuto Quicksort, WebAssembly");

    let heapBuf = wasm._malloc(millionInt.length * Uint32Array.BYTES_PER_ELEMENT);
    wasm.HEAP32.set(millionInt, heapBuf / 4)

    time = Date.now();
    wasm.ccall('sort', null, ['number', 'number', 'number'], [heapBuf, 0, millionInt.length - 1]);
    console.log(` - 10\u2076 entries sorted in ${Date.now() - time}ms`);

    wasm._free(heapBuf);
  })


</script>
</body>
</html>
