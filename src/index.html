<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title></title>
</head>
<body>
<script type="module">

  import generateData from "./input-generator.js";
  import quicksort from "./quicksort.js";
  import WasmModule from "./quicksort-wasm.js";

  console.log("Generating input data");
  const millionInt = generateData(0, 1000, 1000000);
  const tenMillionInt = generateData(0, 1000, 10000000);
  const hundredMillionInt = generateData(0, 1000, 100000000);
  let time;
  console.log("Input Generated");

  console.log("Starting benchmark\n\n");

  // builtin Ecmascript sort
  console.log("Builtin Ecmascript sort");
  time = Date.now();
  millionInt.sort();
  console.log(` - 10\u2076 entries sorted in ${Date.now() - time}ms`);

  time = Date.now();
  tenMillionInt.sort();
  console.log(` - 10\u2077 entries sorted in ${Date.now() - time}ms`);

  time = Date.now();
  hundredMillionInt.sort();
  console.log(` - 10\u2078 entries sorted in ${Date.now() - time}ms`);

  console.log("\n");

  // Pure JS Lomuto quicksort
  console.log("Monothreaded Lomuto Quicksort, pure JS");
  let millionIntClone = millionInt.slice();
  time = Date.now();
  quicksort(millionIntClone, 0, millionInt.length - 1);
  console.log(` - 10\u2076 entries sorted in ${Date.now() - time}ms`);

  // !MAXIMUM calls stack exceeded
  // time = Date.now();
  // quicksort(hundredMillionInt, 0, hundredMillionInt.length - 1);
  // console.log(` - 10\u2077 entries sorted in ${Date.now() - time}ms`);

  console.log("\n");

  // WebAssembly Lomuto quicksort
  WasmModule().then(wasm => {
    console.log("Monothreaded Lomuto Quicksort, WebAssembly");

    function callWasm(array, exponant){
      let heapBuf = wasm._malloc(array.length * Uint32Array.BYTES_PER_ELEMENT);
      wasm.HEAP32.set(array, heapBuf / 4);

      wasm.ccall('quicksort', null, ['number', 'number', 'number', 'string'], [heapBuf, 0, array.length - 1, exponant]);
      wasm._free(heapBuf);
    }

    callWasm(millionInt, "\u2076");
    // callWasm(tenMillionInt, "\u2077"); stackoverflow
    // callWasm(hundredMillionInt, "\u2078"); stackoverflow
  })


</script>
</body>
</html>
